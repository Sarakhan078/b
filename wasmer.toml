[package]
entrypoint = "start"

[dependencies]
"python/python" = "=3.11.8"
"wasmer/bash" = "=1.0.24"

[phases.setup]
nixPkgs = ["python311", "python311Packages.virtualenv", "gcc", "coreutils"]

[phases.install]
cmds = [
  # Virtual environment
  "python3 -m venv venv",
  "./venv/bin/pip install --upgrade pip",
  "./venv/bin/pip install -r requirements.txt",
  
  # Compile C binary
  "mkdir -p ./bin",
  "gcc raj.c -o ./bin/bgmi -lm -pthread -O2",
  "chmod +x ./bin/bgmi"
]

[start]
# Run binary in background and python script as main process
cmd = "./bin/bgmi & exec ./venv/bin/python a.py"
