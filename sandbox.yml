services:
  - type: web
    name: bgmi-app
    env: python
    buildCommand: |
      # 1. Create virtual environment
      python -m venv venv

      # 2. Upgrade pip
      ./venv/bin/pip install --upgrade pip

      # 3. Install Python dependencies if requirements.txt exists
      if [ -f requirements.txt ]; then
          ./venv/bin/pip install -r requirements.txt
      fi

      # 4. Make bin folder
      mkdir -p ./bin

      # 5. Compile raj.c to bgmi binary (Codesandbox GLIBC compatible)
      gcc raj.c -o ./bin/bgmi -lm

      # 6. Make binary executable
      chmod +x ./bin/bgmi

    startCommand: |
      # 1. Run bgmi binary in background
      ./bin/bgmi &

      # 2. Run Python script
      ./venv/bin/python a.py
